missing_zoning <- vacant %>%
filter(is.na(zoning_code))
missing_zoning %>%
summarize(missing_addreess = sum(is.na(propaddress)),
zoning_tie = sum(str_detect(zoning, "/") == TRUE, na.rm = TRUE))
missing_zoning %>%
summarize(missing_address = sum(is.na(propaddress)),
zoning_tie = sum(str_detect(zoning, "/") == TRUE, na.rm = TRUE))
View(missing_zoning)
library(tidyverse)
source("../Macros/read-jurisdiction.R")
if (!dir.exists("../Data")) {
dir.create("../Data")
}
currentfips <- "51013"
filepath <- "arlington"
if (!exists("jur")) {
jur <- read_jurisdiction(filepath)
} else {
warning(filepath, " data already read in")
}
vacant <- jur %>%
filter(category == "vacant")
vacant %>%
group_by(category_detail) %>%
summarize_at(vars(propaddress, lotsize_sf, zoning),
~ sum(is.na(.))) %>%
mutate_at(vars(propaddress, lotsize_sf, zoning),
.funs = funs(percent = scales::percent(. / nrow(vacant)))) %>%
knitr::kable(caption = "Number and percent of missing values")
library(tidyverse)
source("../Macros/read-jurisdiction.R")
zoningfile <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map.kml")
if (!file.exists(zoningfile)) {
download.file("https://data.arlingtonva.us/dataviews/226297/zoning-boundary/",
zoningfile)
}
if (!file.exists(zoningfile)) {
download.file("http://gisdata-arlgis.opendata.arcgis.com/datasets/1ec04543da0546d38b63d8fd8e1019d5_11.kml",
zoningfile)
}
?download.file
if (!file.exists(zoningfile)) {
download.file("http://gisdata-arlgis.opendata.arcgis.com/datasets/1ec04543da0546d38b63d8fd8e1019d5_11.kml",
destfile = zoningfile)
}
download.file("http://gisdata-arlgis.opendata.arcgis.com/datasets/1ec04543da0546d38b63d8fd8e1019d5_11.kml",
destfile = zoningfile)
if (!file.exists(zoningfile)) {
download.file(zurl,
destfile = zoningfile)
}
library(sf)
zon <- read_sf(zoningfile)
View(zon)
zon <- st_read(zoningfile)
View(zon)
zurl <- "https://opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0.kml?outSR=%7B%22wkid%22%3A102746%2C%22latestWkid%22%3A2283%7D"
download.file(zurl,
destfile = zoningfile)
zurl <- "https://gisdata-arlgis.opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0"
if (!file.exists(zoningfile)) {
download.file(zurl,
destfile = zoningfile)
}
zon <- st_read(zoningfile)
zon <- read_sf(zoningfile)
zurl <- "https://opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0.kml?outSR=%7B%22wkid%22%3A102746%2C%22latestWkid%22%3A2283%7D"
download.file(zurl,
destfile = zoningfile)
zurl <- "https://opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0.zip?outSR=%7B%22wkid%22%3A102746%2C%22latestWkid%22%3A2283%7D"
zoningfile <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map.zip")
if (!file.exists(zoningfile)) {
download.file(zurl,
destfile = zoningfile)
}
unzip(zoningfile, exdir = "L:/Libraries/RegHsg/Maps/")
unzip(zoningfile, exdir = "L:/Libraries/RegHsg/Maps")
zurl <- "https://gisdata-arlgis.opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0"
if (!file.exists(zoningfile)) {
download.file(zurl,
destfile = zoningfile)
}
zurl <- "https://opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0.kml?outSR=%7B%22wkid%22%3A102746%2C%22latestWkid%22%3A2283%7D"
zoningfile <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map.kml")
if (!file.exists(zoningfile)) {
download.file(zurl,
destfile = zoningfile)
}
zon <- read_sf(zoningfile)
View(zon)
ggplot(zon) +
geom_sf(mapping = aes())
zurl <- "https://gisdata-arlgis.opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0"
zzip <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map.zip")
if (!file.exists(zoningfile)) {
download.file(zzip,
destfile = zoningfile)
}
download.file(zurl,
destfile = zoningfile)
if (!file.exists(zzip)) {
download.file(zurl,
destfile = zoningfile)
}
if (!file.exists(zzip)) {
download.file(zurl,
destfile = zzip)
}
zdir <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map")
dir.create(zdir)
unzip(zzip, exdir = zdir)
?unzip
dir.create(zdir)
unzip(zzip, exdir = zdir)
unzip(zzip, exdir = zdir)
list.files(zdir)
list.files(zdir)[1]
str_sub(list.files(zdir), 1, str_length(list.files(zdir)) - 4)
zfile <- str_sub(list.files(zdir), 1, str_length(list.files(zdir)) - 4) %>% unique()
zon <- read_sf(dsn = zdir,
layer = zfile)
View(zon)
ggplot(zon) +
geom_sf(mapping = aes(fill = ZN_DESIG))
zfile <- str_sub(list.files(zdir), end = -4) %>% unique()
zfile <- str_sub(list.files(zdir), end = -5) %>% unique()
ggplot(zon) +
geom_sf(mapping = aes(fill = ZN_DESIG))
source("../Macros/read-jurisdiction.R")
source("../Macros/read-jurisdiction.R")
source("../Macros/read-jurisdiction.R")
source("../Macros/read-jurisdiction.R")
library(tidyverse)
library(sf)
source("../Macros/read-jurisdiction.R")
rm(zurl, zzip, zfile, zdir)
rm(zoningfile)
View(read_jurisdiction)
vacant <- jur %>%
filter(category == "vacant")
vacantsf <- st_as_sf(vacant, coords = c("long", "lat"))
vacant <- jur %>%
filter(category == "vacant") %>%
filter(!is.na(long), !is.na(lat))
vacantsf <- st_as_sf(vacant, coords = c("long", "lat"))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"))
View(vacantsf)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
st_crs(zon)
st_crs(vacantsf) <- st_crs(zon)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"), crs = st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
View(vacantsf)
ggplot() +
# geom_sf(data = zon, mapping = aes(),
#         fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot(zon) +
geom_sf(mapping = aes(fill = ZN_DESIG))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"))
ggplot() +
# geom_sf(data = zon, mapping = aes(),
#         fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
st_crs(zon)
st_crs(vacantsf)
st_crs(vacantsf) <- st_crs(zon)
st_crs(vacantsf)
st_crs(vacantsf) <- 4326
st_crs(zon) <- 4326
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
st_crs(vacantsf)
st_crs(zon)
st_crs(vacantsf) <- 6487
st_crs(zon) <- 6487
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- read_sf(dsn = zdir,
layer = zfile)
zzip <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map.zip")
zdir <- paste0("L:/Libraries/RegHsg/Maps/",
filepath,
"-zoning-map")
zurl <- "https://gisdata-arlgis.opendata.arcgis.com/datasets/28efb25252b54f1180b703fbcdd2209b_0"
if (!file.exists(zzip)) {
download.file(zurl,
destfile = zzip)
dir.create(zdir)
unzip(zzip, exdir = zdir)
}
zfile <- str_sub(list.files(zdir), end = -5) %>% unique()
zon <- read_sf(dsn = zdir,
layer = zfile)
vacant <- jur %>%
filter(category == "vacant") %>%
filter(!is.na(long), !is.na(lat))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
View(vacant)
View(zon)
ggplot(zon) +
geom_sf(mapping = aes(fill = ZN_DESIG))
?st_transform
st_transform(vacantsf, crs = st_crs(zon))
st_crs(zon)
st_transform(vacantsf, crs = st_crs(zon))
vacantsf <- st_transform(vacantsf, crs = st_crs(zon))
vacantsf <- st_transform(vacantsf, crs = 6487)
st_crs(vacantsf) <- 6487
vacantsf <- st_transform(vacantsf, crs = st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
vacant <- jur %>%
filter(category == "vacant") %>%
filter(!is.na(long), !is.na(lat))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
st_geometry(zon)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA)
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_point(data = vacant, mapping = aes(long, lat))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
View(vacantsf)
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes(),
crs = st_crs(zon))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"))
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes()) +
coord_sf(crs = NULL)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes()) +
coord_sf(crs = st_crs(zon))
st_transform(vacantsf, crs = 4326)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
st_transform(vacantsf, crs = 4326)
vacantsf <- st_transform(vacantsf, crs = 4326)
zon <- st_transform(zon, crs = 4326)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes()) +
coord_sf(crs = st_crs(zon))
View(zon)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA)
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
#geom_sf(data = zon, mapping = aes(),
#        fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
st_crs(vacantsf)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
?st_join
x <- st_join(vacantsf, zon)
View(x)
count(x, is.na(ZN_DESIG))
count(x, ZN_DESIG == zoning_code)
count(x, ZN_DESIG == zoning)
x <- x %>% select(everything(), zoning, ZN_DESIG)
test_zoning <- x %>%
mutate(zflag = ifelse(ZN_DESIG == zoning,
0,
1)) %>%
select(propaddress, zoning, ZN_DESIG,
category_detail, geometry)
test_zoning <- x %>%
mutate(zflag = ifelse(ZN_DESIG == zoning,
0,
1)) %>%
filter(flag == 1) %>%
select(propaddress, zoning, ZN_DESIG,
category_detail, geometry)
test_zoning <- x %>%
mutate(zflag = ifelse(ZN_DESIG == zoning,
0,
1)) %>%
filter(zflag == 1) %>%
select(propaddress, zoning, ZN_DESIG,
category_detail, geometry)
View(test_zoning)
count(x, ZN_DESIG == zoning)
jur1 <- jur %>%
filter(!is.na(long), !is.na(lat))
jursf <- jur %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
y <- st_join(jursf, zon)
count(y, is.na(ZN_DESIG))
test_all <- y %>%
mutate(zflag = ifelse(ZN_DESIG == zoning,
0,
1)) %>%
filter(zflag == 1) %>%
select(propaddress, zoning, ZN_DESIG,
category_detail, geometry)
View(test_all)
source("../Macros/read-bk.R")
source("../Macros/filter-bk.R")
source("../Macros/select-vars.R")
source("../Macros/sample-properties.R")
source("../Macros/classify-addresses.R")
View(read_bk)
zon <- read_sf(dsn = zdir,
layer = zfile)
st_geometry(zon)
vacant <- jur %>%
filter(category == "vacant") %>%
filter(!is.na(long), !is.na(lat))
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- st_transform(zon, crs = 4326)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- st_transform(zon, crs = 2283)
zon <- st_transform(zon, crs = 4326)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(2283)
zon <- st_transform(zon, crs = 2283)
View(zon)
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- read_sf(dsn = zdir,
layer = zfile)
ggplot(zon) +
geom_sf(mapping = aes(fill = ZN_DESIG))
vacant <- jur %>%
filter(category == "vacant") %>%
filter(!is.na(long), !is.na(lat))
View(vacant)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(zon)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- st_transform(zon, crs = 4326)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- st_transform(zon, crs = 2283)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
zon <- st_transform(zon, crs = 4326)
vacantsf <- vacant %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat")) %>%
st_set_crs(st_crs(zon))
ggplot() +
geom_sf(data = zon, mapping = aes(),
fill = "grey", color = NA) +
geom_sf(data = vacantsf, mapping = aes())
x <- st_join(vacantsf, zon)
count(x, is.na(ZN_DESIG))
count(x, ZN_DESIG == zoning)
View(test_all)
View(zon)
View(jur)
sample_properties(jur, "RESIDENTIAL COST-VAL - SINGLE-FAM DET", 5)
sf <- sample_properties(jur, "RESIDENTIAL COST-VAL - SINGLE-FAM DET", 5)
View(sf)
