---
title: "Regional Housing Framework"
subtitle: "Test missing variables for Arlington County"
author: ""
output:
  html_document:
    number_sections: FALSE
    self_contained: TRUE
    code_folding: show
    toc: TRUE
    toc_float: TRUE
    css: ../www/web_report.css
    editor_options:
      chunk_output_type: console
---

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" />

Library: RegHsg

Project: Regional Housing Framework

Author: Sarah Strochak

Version: R 3.5.1, RStudio 1.1.423

Last updated `r format(Sys.time(), '%B %d, %Y')`

Environment: Local Windows session (desktop)


```{r rmarkdown-setup, echo = FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
# knitr::opts_chunk$set(eval = FALSE)
```

## Description

There are two variables necessary to get a measure of units per acre:

* Number of units
* Lot size

In this program, we assess the level of missing-ness, and use an imputation strategy to define values for parcels with missing information.

## Set-up
#### Load libraries and functions
```{r setup}
library(tidyverse)

source("../Macros/read-jurisdiction.R")

```

#### Create directory for data exports
```{r dir}
if (!dir.exists("Data")) {
  dir.create("Data")
}

```


#### Set FIPS code and filepath name
```{r fips}
currentfips <- "51013"
filepath <- "arlington"
```

#### Load in Black Knight data for the region, select jurisdiction and standard variables
```{r read}
if (!exists("jur")) {
  jur <- read_jurisdiction(filepath)
} else {
  warning(filepath, " data already read in")
}

```

#### Select only residential properties

```{r res}
resjur <- jur %>% 
  filter(residential == 1,
         category %in% c("sf", "mf", "vacant"))
  
```

## Assess missing-ness

### Convert 0 to missing

We want to ensure that values of 0 are not used in calculations.
```{r zeros}
resjur <- resjur %>% 
  mutate_at(vars(numberofunits, buildingarea,
                 lotsize_acres, lotsize_sf),
            ~ ifelse(. == 0, NA, .))
```


### Missing variable tabulations

Different imputation methods should be used for data with different levels of missing inputs.

**Baseline categories**

```{r missing}

resjur %>% 
  group_by(category) %>% 
  summarize_at(vars(lotsize_acres, numberofunits, buildingarea),
               ~ sum(is.na(.))) %>% 
  mutate_at(vars(lotsize_acres, numberofunits, buildingarea),
            .funs = funs(percent = scales::percent(. / nrow(resjur)))) %>% 
  select(category,
         `Lot size` = lotsize_acres_percent,
         `Number of units` = numberofunits_percent,
         `Building area` = buildingarea_percent) %>% 
  knitr::kable(caption = "Percent of missing values for each variable")

```

**Detailed categories**


```{r missing2}

resjur %>% 
  group_by(category_detail) %>% 
  summarize_at(vars(lotsize_acres, numberofunits, buildingarea),
               ~ sum(is.na(.))) %>% 
  mutate_at(vars(lotsize_acres, numberofunits, buildingarea),
            .funs = funs(percent = scales::percent(. / nrow(resjur)))) %>% 
  select(category_detail,
         `Lot size` = lotsize_acres_percent,
         `Number of units` = numberofunits_percent,
         `Building area` = buildingarea_percent) %>% 
  knitr::kable(caption = "Percent of missing values for each variable")

```